
<!-- Header | TODO: make more friendly -->
<div class="row mb-3">
	<div class="col-12">
		<div class="card bg-100 shadow-none border mb-0">
			<div class="card-body p-0">
				<div class="row gx-0 p-2 pb-0 mb-0 flex-between-center" id="header-top">
					<div class="col-auto">
						<div>
							<h6 class="text-primary fs-10 mb-0">Welcome to </h6>
							<h4 class="text-primary fw-bold mb-0">
								Squares
								<span class="text-info fw-medium">Event Management</span>
							</h4>
						</div>
					</div>
					<div class="col-auto">
						<%= link_to new_event_path, class: "btn btn-primary btn-sm btn-outline" do %>
							<span class="fas fa-plus me-1"></span> Create Event
						<% end %>
					</div>
				</div>
				<div class="row gx-0 p-2 pt-0" id="header-info">
				</div>
				<% if false %>
					<div class="row gx-0 p-2 bg-700 text-200" id="header-toolbar">
					</div>
				<% end %>
			</div>
		</div>
	</div>
</div>

<% has_active_events = @current_events.any? || @upcoming_events.any? %>
<div class="row g-3 mb-3">
	<% if has_active_events %>
	<div class="col-lg-5">

		<% if @current_events.present? && @current_events.any? %>
			<% @current_events.each do |event| %>
				<div class="card mb-4">
					<div class="bg-holder d-none d-xl-block bg-card" style="background-image:url(<%= asset_path("backgrounds/corner-1.png") %>);opacity: 0.7;pointer-events:none;"></div><!--/.bg-holder-->
					<div class="card-body">
						<%= link_to event do %>
							<h5><%= event.title %></h5>
						<% end %>

						<div>
							<div class="badge rounded-pill badge-subtle-success fs-11">
								In Progress
								<span class="fas fa-check ms-1" data-fa-transform="shrink-2"></span>
							</div>
							<% if event.end_date.present? %>
								<strong class="ms-2">Ends:</strong>
								<span><%= event.end_date %></span>
							<% end %>
						</div>

						<div class="row g-2 mt-4 align-items-top">
							<div class="col-6 col-sm-5">
								<div class="d-flex position-relative">
									<div class="icon-item icon-item-sm border rounded-3 shadow-none me-2">
										<span class="fas fa-football-ball text-primary"></span>
									</div>
									<div class="flex-1">
										<%= link_to event_path(event, anchor: "games"), class: "text-800" do %>
											<h6 class="mb-0">Games</h6>
										<% end %>
										<% if event.games.upcoming.any? %>
											<p class="mb-0 fs-11 text-600">
												<strong>Next: <%= event.games.upcoming.earliest_first.first.title %></strong>, in
												<%= time_ago_in_words(event.games.upcoming.earliest_first.first.starts_at.in_time_zone(current_timezone)) %>
											</p>
										<% end %>
									</div>
								</div>
							</div>
							<div class="col-6 col-sm-5">
								<div class="d-flex">
									<div class="icon-item icon-item-sm border rounded-3 shadow-none me-2">
										<span class="bi bi-newspaper text-success"></span>
									</div>
									<div class="flex-1">
										<%= link_to event_path(event, anchor: "posts"), class: "text-800" do %>
											<h6 class="mb-0">Posts</h6>
										<% end %>
										<p class="mb-0 fs-11 text-600">
											<strong>"<%= event.posts.recent.first.title %>"</strong> by
											<strong><%= event.posts.recent.first.user.display_name %></strong>, 
											<%= time_ago_in_words(event.posts.recent.first.created_at.in_time_zone(current_timezone)) %> ago
										</p>
									</div>
								</div>
							</div>
						</div>
						
					</div>
				</div>
			<% end %>
		<% end %>

		<% if @upcoming_events.present? && @upcoming_events.any? %>
			<% @upcoming_events.each do |event| %>
				<div class="card mb-4">
					<div class="bg-holder d-none d-xl-block bg-card" style="background-image:url(<%= asset_path("backgrounds/corner-4.png") %>);opacity: 0.7;pointer-events:none;"></div><!--/.bg-holder-->
					<div class="card-body">

						<h5><%= event.title %></h5>
						<div>
							<div class="badge rounded-pill badge-subtle-primary fs-11">
								Upcoming
								<span class="fas fa-stopwatch ms-1" data-fa-transform="shrink-2"></span>
							</div>
							<% if event.end_date.present? %>
								<strong class="ms-2">Ends:</strong>
								<span><%= event.end_date %></span>
							<% end %>
						</div>
						<div class="mt-4 text-center fw-600">
							<h5 class="text-600">Event begins in <%= time_ago_in_words(event.start_date.in_time_zone(current_timezone)) %></h5>
						</div>
					</div>
				</div>
			<% end %>
		<% end %>
	</div>
	<% end %>

	<div class="<%= has_active_events ? 'col-lg-7' : 'col-12' %>">
		<%# Inctive Events Table %>
		<div class="card mb-3" id="eventsTable">
			<div class="card-header border-bottom border-200 px-3 py-2">
				<div class="d-flex justify-content-between align-items-center">
					<h5 class="mb-0">Completed Events</h5>
					<span class="badge bg-primary rounded-pill"><%= @completed_events.count %></span>
				</div>
			</div>
			<div class="card-body p-0">
				<div class="table-responsive scrollbar">
					<table class="table table-sm table-striped fs-10 mb-0 overflow-hidden">
						<thead class="bg-200">
							<tr>
								<th class="text-900">Title</th>
								<th class="text-900">Start Date</th>
								<th class="text-900">End Date</th>
								<th class="text-900 text-center">Games</th>
								<th class="text-900 text-end">Actions</th>
							</tr>
						</thead>
						<tbody>
							<% if @completed_events.any? %>
								<% @completed_events.each do |event| %>
									<tr>
										<td class="py-2">
											<%= link_to event.title, event_path(event), class: "fw-semi-bold" %>
										</td>
										<td class="py-2"><%= event.start_date.strftime("%b %d, %Y") %></td>
										<td class="py-2">
											<% if event.end_date.present? %>
												<%= event.end_date.strftime("%b %d, %Y") %>
											<% else %>
												<span class="text-muted">Open</span>
											<% end %>
										</td>
										<td class="py-2 text-center">
											<span class="badge bg-secondary rounded-pill"><%= event.games.count %></span>
										</td>
										<td class="text-end pe-2 py-2">
											<button class="btn btn-link text-600 btn-sm dropdown-toggle dropdown-caret-none btn-reveal" type="button" id="dropdown-event-<%= event.id %>" data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
												<span class="fas fa-ellipsis-h fs-10"></span>
											</button>
											<div class="dropdown-menu dropdown-menu-end border py-2" aria-labelledby="dropdown-event-<%= event.id %>">
												<%= link_to event_path(event), class: "dropdown-item" do %>
													<span class="fas fa-eye me-2"></span> View
												<% end %>
												<%= link_to edit_event_path(event), class: "dropdown-item" do %>
													<span class="fas fa-edit me-2"></span> Edit
												<% end %>
												<% if event.in_progress? && event.end_date.nil? %>
													<%= link_to end_event_event_path(event),
															data: { turbo_method: :patch, turbo_confirm: "End #{event.title} today?" },
															class: "dropdown-item text-success" do %>
														<span class="fas fa-flag-checkered me-2"></span> End Event
													<% end %>
												<% end %>
												<div class="dropdown-divider"></div>
												<%= link_to deactivate_event_path(event),
														data: { turbo_method: :patch, turbo_confirm: "Deactivate #{event.title}?" },
														class: "dropdown-item text-warning" do %>
													<span class="fas fa-eye-slash me-2"></span> Deactivate
												<% end %>
											</div>
										</td>
									</tr>
								<% end %>
							<% else %>
								<tr>
									<td colspan="6" class="text-center py-4 text-muted">No completed events yet.</td>
								</tr>
							<% end %>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
