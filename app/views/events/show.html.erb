<%= turbo_stream_from @event %>

<!-- Shiny header  -->
<div class="row mb-3">
	<div class="col-12">
		<div class="card bg-100 shadow-none border mb-0">
			<div class="card-body p-1 pb-0">
				<div class="row gx-0 p-2 pb-0 mb-0 flex-between-center" id="header-top">
					<div class="col-auto ps-2">
						<div>
							<h6 class="fs-10 mb-0">
								<%= link_to events_path, class: "text-decoration-none text-muted mb-1 d-block" do %>
									<i class="bi bi-arrow-left" data-fa-transform="shrink-4 down-1"></i> Back to Events
								<% end %>
							</h6>
							<h4 class="text-primary fw-bold mb-0">
								Event:
								<span class="text-info fw-medium"><%= @event.title %></span>
							</h4>
						</div>
					</div>
					<div class="col-auto">
						<% if admin? %>
						<% end %>
					</div>
				</div>
				<div class="row gx-0 p-2" id="header-info">
					<div class="col-3 text-start">
						<h6 class="text-muted fs-10 mb-0">
							<% if @event.upcoming? %>
								<span class="badge bg-info ms-2">Upcoming</span>
							<% elsif @event.in_progress? %>
								<span class="badge bg-success ms-2">In Progress</span>
							<% else %>
								<span class="badge bg-secondary ms-2">Completed</span>
							<% end %>
						</h6>
					</div>
					<div class="col-6 text-center">
						<h6 class="text-muted fs-10 mb-0 pt-1">
							<%= @event.start_date.strftime("%B %d, %Y") %>
							<% if @event.end_date.present? %>
								- <%= @event.end_date.strftime("%B %d, %Y") %>
							<% else %>
								- <span class="fst-italic">ongoing</span>
							<% end %>
						</h6>
					</div>
					<div class="col-3 text-end"></div>
				</div>
				<% if show_admin_tools? %>
					<div class="row gx-0 p-2 bg-700 text-200" id="header-toolbar">
						<div class="col-4 text-200 text-start">
							<%= render "events/pdf_status", event: @event %>
						</div>
						<div class="col-4 text-200 text-center">
							<%= link_to edit_event_path(@event), class: "btn btn-outline-light btn-sm" do %>
								<span class="fas fa-edit me-1"></span> Edit
							<% end %>
							<% if @event.in_progress? && @event.end_date.blank? %>
								<%= link_to end_event_event_path(@event),
									data: { turbo_method: :patch, turbo_confirm: "End this event now? This will set the end date to today." },
									class: "btn btn-outline-warning btn-sm ms-2" do %>
									<span class="fas fa-flag-checkered me-1"></span> End Now
								<% end %>
							<% end %>
						</div>
						<div class="col-4 text-200 text-end">
							<%= link_to winners_event_path(@event), class: "btn btn-outline-warning btn-sm me-2" do %>
								<span class="fas fa-trophy me-1"></span> Winners
							<% end %>
						</div>
					</div>
				<% end %>
			</div>
		</div>
	</div>
</div>

<!-- game cards banner -->
<div class="row mt-4 mb-1">
	<% @banner_rows.headers.each do |header| %>
		<div class="col-4 text-start">
			<% if header %>
				<h6><%= header %></h6>
			<% end %>
		</div>
	<% end %>
</div>
<% @banner_rows.rows.each do |row| %>
	<div class="row mb-3">
		<% row.each do |game| %>
			<div class="col-4 text-center">
				<% if game.nil? %>
					<%= render "events/components/game_placeholder_card" %>
				<% elsif game.upcoming? %>
					<%= render "events/components/game_upcoming_card", game: game %>
				<% else %>
					<%= render "events/components/game_score_card", game: game %>
				<% end %>
			</div>
		<% end %>
	</div>
<% end %>

<!-- tab row -->
<div class="row mb-3 gx-0" data-controller="tabs" data-tabs-default-tab-value="games">
	<div class="card">
		<div class="card-header p-0">
			<ul class="nav nav-tabs border-0 flex-nowrap gx-0 w-100">
				<li class="nav-item" role="presentation">
					<a id="games-tab" class="nav-link p-3 mb-0 active" role="tab" href="#games"
					   data-tabs-target="button" data-action="tabs#select" data-tabs-panel="games">
						<h5 class="mb-0 text-600 fs-9">
							<span class="fas fa-football-ball icon text-600 me-1"></span>
							Games <span>(<%= @games.size %>)</span>
						</h5>
					</a>
				</li>
				<li class="nav-item" role="presentation">
					<a id="posts-tab" class="nav-link p-3 mb-0" role="tab" href="#posts"
					   data-tabs-target="button" data-action="tabs#select" data-tabs-panel="posts">
						<h5 class="mb-0 text-600 fs-9">
							<span class="bi bi-newspaper icon text-600 me-1"></span>
							Posts <span>(<%= @posts.size %>)</span>
						</h5>
					</a>
				</li>
				<% if admin? %>
					<li class="nav-item ms-auto d-flex align-items-center pe-3">
						<span data-tabs-target="action" data-tabs-panel="games">
							<%= link_to new_game_path(event_id: @event.id), class: "btn btn-primary btn-sm" do %>
								<span class="fas fa-plus me-1"></span> New Game
							<% end %>
						</span>
						<span data-tabs-target="action" data-tabs-panel="posts" class="d-none">
							<%= link_to new_event_post_path(@event), class: "btn btn-primary btn-sm" do %>
								<span class="fas fa-plus me-1"></span> New Post
							<% end %>
						</span>
					</li>
				<% end %>
			</ul>
		</div>
		<div class="card-body p-0" id="games" data-tabs-target="panel">

			<table class="table table-sm fs-10 m-0">
				<% if @games_in_progress.any? %>
					<tbody id="in-progress-games-table">
						<tr>
							<td colspan="9" class="bg-500 py-2">
								<h6 class="text-200 my-0">Live Games</h6>
							</td>
						</tr>
						<% @games_in_progress.each do |game| %>
							<%= render "events/components/game_row", game: game %>
						<% end %>
					</tbody>
				<% end %>

				<% if @games_upcoming.any? %>
					<tbody id="upcoming-games-table">
						<tr>
							<td colspan="9" class="bg-500 py-2">
								<h6 class="text-200 my-0">Upcoming Games</h6>
							</td>
						</tr>
						<% @games_upcoming.each do |game| %>
							<%= render "events/components/game_row", game: game %>
						<% end %>
					</tbody>
				<% end %>

				<% if @games_completed.any? %>
					<tbody id="completed-games-table">
						<tr>
							<td colspan="9" class="bg-500 py-2">
								<h6 class="text-200 my-0">Completed Games</h6>
							</td>
						</tr>
						<% @games_completed.each do |game| %>
							<%= render "events/components/game_row", game: game %>
						<% end %>
					</tbody>
				<% end %>
			</table>

		</div>
	</div>
	<!-- Posts panel: outside the card for floating card styling -->
	<div class="d-none mt-3" id="posts" data-tabs-target="panel">
		<div class="row">
			<% if @posts.any? %>
				<div class="col-8">
					<%= render "posts/content", post: @posts.first %>
				</div>
				<div class="col-4">
					<div class="card" data-controller="post-list">
						<div class="card-header border-bottom py-1"><h6 class="mb-0">Post Archive</h6></div>
						<div class="card-body py-0 px-0">
							<table class="table table-sm fs-10 m-0">
								<tbody>
									<% @posts.each do |post| %>
										<tr data-post-list-target="item">
											<td class="py-2 ps-1">
												<span class="post-archive-icon bi bi-chevron-left me-1"></span><%= link_to content_post_path(post),
													data: { turbo_frame: "post-content", action: "post-list#select" },
													class: "post-archive-link" do %><%= post.title %><% end %>
											</td>
										</tr>
									<% end %>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			<% else %>
				<div class="col-12">
					<div class="card">
						<div class="card-body text-center text-muted py-5">
							<span class="bi bi-newspaper fs-3 d-block mb-2"></span>
							No posts yet for this event.
							<% if admin? %>
								<div class="mt-3">
									<%= link_to new_event_post_path(@event), class: "btn btn-primary btn-sm" do %>
										<span class="fas fa-plus me-1"></span> Create First Post
									<% end %>
								</div>
							<% end %>
						</div>
					</div>
				</div>
			<% end %>
		</div>
	</div>
</div>

