<div class="row justify-content-center" data-controller="winners-worksheet" data-winners-worksheet-event-id-value="<%= @event.id %>">
  <div class="col-lg-8 col-md-10 col-12">
    <!-- Header -->
    <div class="card bg-100 shadow-none border mb-3">
      <div class="card-body py-2">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="fs-10 mb-0">
              <%= link_to winners_event_path(@event), class: "text-decoration-none text-muted" do %>
                <i class="bi bi-arrow-left me-1"></i> Back to Winners
              <% end %>
            </h6>
            <h4 class="text-primary fw-bold mb-0 mt-1">
              <span class="fas fa-clipboard-check text-info me-2"></span>
              Check Writing Worksheet
            </h4>
          </div>
          <div class="text-end">
            <div class="fs-10 text-muted mb-1" data-winners-worksheet-target="progress">0 of 0 checked</div>
            <%= link_to winners_event_path(@event), class: "btn btn-success" do %>
              <span class="fas fa-check me-1"></span> Finished
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress mb-3" style="height: 8px;">
      <div class="progress-bar bg-success"
           role="progressbar"
           style="width: 0%"
           aria-valuenow="0"
           aria-valuemin="0"
           aria-valuemax="100"
           data-winners-worksheet-target="progressBar"></div>
    </div>

    <!-- Worksheet Table -->
    <div class="card">
      <div class="card-header border-bottom d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><%= @event.title %> - $<%= number_with_delimiter(@total_awarded) %> Total</h5>
        <button type="button"
                class="btn btn-sm btn-outline-secondary"
                data-action="winners-worksheet#clearAll">
          <span class="fas fa-undo me-1"></span> Reset
        </button>
      </div>
      <div class="card-body p-0">
        <table class="table table-hover mb-0">
          <thead class="bg-200">
            <tr>
              <th class="ps-3" style="width: 60px;"></th>
              <th>Payee</th>
              <th class="text-end pe-4" style="width: 120px;">Amount</th>
            </tr>
          </thead>
          <tbody>
            <% @winners.each do |family_id, winners| %>
              <% family = @families[family_id] %>
              <% family_total = winners.sum { |w| w[:total] } %>
              <% family_name = family.display_name.presence || family.name %>
              <% group_id = "family-#{family_id}" %>

              <% if family.is_a?(Single) %>
                <!-- Single player - one row with background -->
                <tr class="bg-100 fs-9">
                  <td class="ps-3 align-middle">
                    <div class="form-check">
                      <input type="checkbox"
                             class="form-check-input"
                             style="width: 1.5em; height: 1.5em;"
                             value="<%= group_id %>-0"
                             data-group-id="<%= group_id %>"
                             data-winners-worksheet-target="groupCheckbox memberCheckbox"
                             data-action="winners-worksheet#toggleMember">
                    </div>
                  </td>
                  <td class="align-middle fw-bold"><%= family_name %></td>
                  <td class="text-end pe-4 align-middle">
                    <span class="fs-8 fw-bold text-success">$<%= number_with_delimiter(family_total) %></span>
                  </td>
                </tr>
              <% else %>
                <!-- Family header row -->
                <tr class="bg-100 fs-9">
                  <td class="ps-3 align-middle">
                    <div class="form-check">
                      <input type="checkbox"
                             class="form-check-input"
                             style="width: 1.5em; height: 1.5em;"
                             data-group-id="<%= group_id %>"
                             data-winners-worksheet-target="groupCheckbox"
                             data-action="winners-worksheet#toggleGroup">
                    </div>
                  </td>
                  <td class="align-middle fw-bold"><%= family_name %></td>
                  <td class="text-end pe-4 align-middle">
                    <span class="fs-8 fw-bold text-success">$<%= number_with_delimiter(family_total) %></span>
                  </td>
                </tr>

                <!-- Individual members -->
                <% winners.each_with_index do |winner, idx| %>
                  <tr class="fs-9">
                    <td class="ps-4 align-middle">
                      <div class="form-check">
                        <input type="checkbox"
                               class="form-check-input"
                               style="width: 1.25em; height: 1.25em;"
                               value="<%= group_id %>-<%= idx %>"
                               data-group-id="<%= group_id %>"
                               data-winners-worksheet-target="memberCheckbox"
                               data-action="winners-worksheet#toggleMember">
                      </div>
                    </td>
                    <td class="align-middle ps-4"><%= winner[:name] %></td>
                    <td class="text-end pe-4 align-middle text-muted">$<%= number_with_delimiter(winner[:total]) %></td>
                  </tr>
                <% end %>
              <% end %>
            <% end %>

            <% if @charities.any? %>
              <% charity_total = @charities.sum { |c| c[:total] } %>
              <% group_id = "charity" %>

              <!-- Charities header -->
              <tr class="bg-100 fs-9">
                <td class="ps-3 align-middle">
                  <div class="form-check">
                    <input type="checkbox"
                           class="form-check-input"
                           style="width: 1.5em; height: 1.5em;"
                           data-group-id="<%= group_id %>"
                           data-winners-worksheet-target="groupCheckbox"
                           data-action="winners-worksheet#toggleGroup">
                  </div>
                </td>
                <td class="align-middle fw-bold">
                  <span class="fas fa-heart text-danger me-1"></span>
                  Charities
                </td>
                <td class="text-end pe-4 align-middle">
                  <span class="fs-8 fw-bold text-success">$<%= number_with_delimiter(charity_total) %></span>
                </td>
              </tr>

              <!-- Individual charities -->
              <% @charities.each_with_index do |charity, idx| %>
                <tr class="fs-9">
                  <td class="ps-4 align-middle">
                    <div class="form-check">
                      <input type="checkbox"
                             class="form-check-input"
                             style="width: 1.25em; height: 1.25em;"
                             value="<%= group_id %>-<%= idx %>"
                             data-group-id="<%= group_id %>"
                             data-winners-worksheet-target="memberCheckbox"
                             data-action="winners-worksheet#toggleMember">
                    </div>
                  </td>
                  <td class="align-middle ps-4"><%= charity[:name] %></td>
                  <td class="text-end pe-4 align-middle text-muted">$<%= number_with_delimiter(charity[:total]) %></td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  .worksheet-checked td {
    color: #adb5bd !important;
    text-decoration: line-through;
  }
  .worksheet-checked td span {
    color: #adb5bd !important;
  }
</style>
